<!doctype html>
<html lang="de">
  <head>
    <meta charset="utf-8" />
    <title>Aktuelles - Ohmoor Squeezers e.V.</title>
    <meta
      name="description"
      content="Aktuelle Neuigkeiten, Ankündigungen und Flyer der Ohmoor Squeezers e.V."
    />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="style.css" />
    <link rel="icon" type="image/png" sizes="32x32" href="favicon-32.png" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  </head>
  <body>
    {{ include: nav.html }}
    <main class="container page">
      <h1>Aktuelles</h1>
      <p class="muted">Neuigkeiten und Ankündigungen.</p>
      <p id="news-status" class="muted">News werden geladen...</p>
      <section id="news-list" class="news-list"></section>
    </main>
    <script>
      (function () {
        var statusEl = document.getElementById("news-status");
        var listEl = document.getElementById("news-list");

        function escapeHtml(value) {
          return String(value || "")
            .replace(/&/g, "&amp;")
            .replace(/</g, "&lt;")
            .replace(/>/g, "&gt;")
            .replace(/\"/g, "&quot;")
            .replace(/'/g, "&#39;");
        }

        function render(newsItems) {
          if (!newsItems.length) {
            statusEl.textContent = "";
            listEl.innerHTML = "<p>Keine News vorhanden.</p>";
            return;
          }

          listEl.innerHTML = newsItems
            .map(function (item) {
              var date = escapeHtml(item.date || "");
              var title = escapeHtml(item.title || "");
              var text = escapeHtml(item.text || "");
              var flyerUrl = String(item.flyer_url || "").trim();
              var flyerLabel = escapeHtml(item.flyer_label || "Flyer (PDF)");
              var flyerText = escapeHtml(item.flyer_text || "Flyer folgt");
              var actionHtml = flyerUrl
                ? '<a class="button" href="' +
                  escapeHtml(flyerUrl) +
                  '" target="_blank" rel="noopener noreferrer">' +
                  flyerLabel +
                  "</a>"
                : '<span class="muted">' + flyerText + "</span>";

              return (
                '<article class="news-card">' +
                '<div class="news-meta">' +
                date +
                "</div>" +
                "<h2>" +
                title +
                "</h2>" +
                "<p>" +
                text +
                "</p>" +
                '<div class="news-actions">' +
                actionHtml +
                "</div>" +
                "</article>"
              );
            })
            .join("");
          statusEl.textContent = "";
        }

        fetch("news.json", { cache: "no-store" })
          .then(function (response) {
            if (!response.ok) {
              throw new Error("HTTP " + response.status);
            }
            return response.json();
          })
          .then(function (data) {
            if (!Array.isArray(data)) {
              throw new Error("news.json hat kein Array-Format");
            }
            render(data);
          })
          .catch(function () {
            statusEl.textContent = "News konnten nicht geladen werden.";
            listEl.innerHTML = "";
          });
      })();
    </script>
    {{ include: footer.html }}
  </body>
</html>
